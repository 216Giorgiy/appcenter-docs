---
title: Preparing Xamarin.UITests for Upload
description: How to upload Xamarin.UITests to App Center for Test
keywords: test cloud
author: glennwester
ms.author: glwest
ms.reviewer: crdun
ms.date: 07/02/2018
ms.topic: article
ms.assetid: 10be6410-6661-45df-931d-2737ed369752
ms.service: vs-appcenter
ms.custom: test
---

# Preparing Xamarin.UITests for Upload

After writing UITests for a Xamarin app, upload the app and tests to App Center for extensive testing on real devices. This section provides details on preparing a Xamarin mobile application before submitting Xamarin.UITests for Xamarin mobile apps to App Center for Test.

Before submitting a test to App Center, you must first[create an app](~/dashboard/creating-and-managing-apps.md) in [Visual Studio App Center](https://appcenter.ms/), and then to create a *test run* using the Test Run wizard available in the **Test** service.

When the Test Run Wizard finishes, it will provide sample terminal commands you can use to submit the app and UITests to App Center for Test. The following two snippets are examples of a command line generated by the Test Run wizard:

For a Xamarin.Android application, the Test Run wizard will generate a terminal command similar to the following:

```
appcenter test run uitest --app "<APP NAME>" --devices "<DEVICE SET NAME>" --app-path <PATH_TO_APK> --test-series "<TEST SERIES>" --locale "en_US" --build-dir <PATH TO UITEST BUILD DIRECTORY>
```

For Xamarin.iOS, the Test Run wizard will generate a terminal command line similar to the following:

```
appcenter test run uitest --app "<APP NAME>" --devices <DEVICE SET ID> --app-path <PATH TO IPA> --test-series "<TEST SERIES>" --locale "en_US" --build-dir <PATH TO UITEST BUILD DIRECTORY>
```

The command parameters include the following pieces of information specific to the newly created rest run:

* **APP NAME** - The name of the app in App Center.
* **PATH TO APK / IPA** - The path to the app being tested.
* **DEVICE SET NAME / ID** - Represents the *device set* where the test will execute. A device set is a collection of devices and operating systems.
* **TEST SERIES** - A label used to group a series of related test runs together. By default, the value of the test series is *master*.
* **PATH TO UITEST BUILD DIRECTORY** - The path to the directory that holds the UITest assembly.

After the test run has been created, ensure that the following software is installed on the computer that will submit the tests:

1. [Node.js](https://nodejs.org/en/) version 8 or better
2. [App Center CLI](~/cli/index.md)

Instructions for [installing the App Center CLI](https://github.com/Microsoft/AppCenter-CLI#installation) maybe be found in the [README.md on GitHub](https://github.com/Microsoft/AppCenter-CLI).

## Preparing Xamarin.Android Apps

> [!IMPORTANT]
> Running Xamarin.UITest on Windows requires [setting the ANDROID_HOME environment variable with the path to the Android SDK](https://www.360logica.com/blog/how-to-set-path-environmental-variable-for-sdk-in-windows/)

To prepare a Xamarin.Android app and UITest for submission to App Center for Test:

1. Ensure that the app requests the `INTERNET` permission.
2. Disable the **Shared Mono Runtime**. The Shared Mono Runtime will prevent UITests from running in App Center for Test.

    In Visual Studio 2017, open the project properties, and select the **Android Options** tab. In the first section, look for **Packaging Properties**, then uncheck **Shared Mono Runtime**.

    In Visual Studio for Mac, Open **Build > Android Build** then select **Project Options**. On the **General** tab, look for **Packaging and Deployment** and uncheck the **Shared Mono Runtime** checkbox.

## Preparing Xamarin.iOS Apps

Xamarin.iOS apps must have the Xamarin Test Cloud Agent linked into the app's .ipa file. The Xamarin Test Cloud Agent is an special, embedded HTTP server that allows UITests to interact with the iOS user interface. The Test Cloud Agent is added to the iOS project via NuGet.

> [!TIP]
> Non-Xamarin.iOS apps are also supported by Xamarin.UITest, but instead of the Xamarin Test Cloud Agent require [linking Calabash](https://github.com/calabash/calabash-ios/wiki/Tutorial%3A-How-to-add-Calabash-to-Xcode).

### Visual Studio (Mac)

For an iOS project In Visual Studio for Mac, right click on the **Packages** folder, select **Add Package**. Search for **Xamarin Test Cloud Agent**, and click **Add Package**:

![Adding the Xamarin Test Cloud Agent](~/test-cloud/preparing-for-upload/images/05-addpackage-xs.png)

### Visual Studio (Windows)

> [!IMPORTANT]
> Xamarin.UITests for iOS apps cannot be executed locally on Windows. You can still create, compile and uploade to App Center Test from Windows.

For an iOS project In Visual Studio for Windows, right click on project and select **Manage NuGet Packages** from the context menu. In the **NuGet Package Manager** Search for **Xamarin Test Cloud Agent** and click **OK** to install that package:

![Adding the Xamarin Test Cloud Agent](~/test-cloud/preparing-for-upload/images/05-addpackage-vs.png)

### Initialize the Xamarin Test Cloud Agent

After adding the Xamarin Test Cloud Agent to the iOS project, you must initialize the Xamarin Test Cloud Agent when the iOS project starts up. Edit the `AppDelegate` class and add the following snippet to the `FinishedLaunching` method:

```csharp
#if ENABLE_TEST_CLOUD
Xamarin.Calabash.Start();
#endif
```

> [!WARNING]
> Apple will reject your app if you submit an app that includes the Xamarin Test Cloud Agent. The Xamarin Test Cloud Agent is only supported for apps signed with Development Provisioning Profiles.

When you surround the initialization code in the **ENABLE_TEST_CLOUD** conditional compile statement, the Xamarin linker will leave the Xamarin Test Cloud Agent in builds that use the **ENABLE_TEST_CLOUD** flag; conventionally **Debug** builds but not **Release** builds. New Xamarin.iOS apps created in Visual Studio use this approach.
